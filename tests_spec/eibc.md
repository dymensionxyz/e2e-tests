## Tests handle

| No | Scenario | Pre-condition | Pre-condition check | Expected result | Expected result check | Covered By |
|----|----------|---------------|---------------------|-----------------|-----------------------|------------|
| 1  | Rollapp token Demand order is created upon memo submission and fulfilled |At least 2 rollapps running, Rollapp A and B. Rollapp B is at finalized height < Rollapp A finalized height. Rollapp B has a channel-id different from the hub-channel-id. | âœ… | Demand order for Rollapp tokens created and fulfilled upon memo submission. | âœ… | [TestEIBCFulfillment_EVM](../tests/eibc_fulfillment_test.go#768) [TestEIBCFulfillment_Wasm](../tests/eibc_fulfillment_test.go#1062) |
| 2  | DYM Demand order is created upon memo submission and fulfilled | Same as the case above | âœ… | Timeout triggered for EIBC transaction from hub to rollapp due to non-finalization. | âœ… | [TestEIBCTimeoutHubToRollapp](../tests/eibc_timeout_test.go#24) |
| 3  | 3rd party token (i.e blumbus) Demand order is created upon memo submission and fulfilled | Same as the case above | âœ… | <ul><li> Eibc demand order created</li><li> Fulfill the eibc demand order</li><li> Verify the originator gets the funds minus the fee right away</li><li> Verify the fulfiller gets the full amount after the grace period is finalized</li><li> No packet commitment left on the rollapp (i.e. ack received). Can be queried using the CLI rollapp-evm q ibc channel packet-commitments transfer \<channel-id></li></ul>| âœ… | [TestEIBCFulfillment_ThirdParty_EVM](../tests/eibc_fulfillment_test.go#1746) [TestEIBCFulfillment_ThirdParty_Wasm](../tests/eibc_fulfillment_test.go#2145)|
| 4  | DYM ibc transfer timeout | Same as the case above | âœ… | <ul><li> send **dym** from dymension to rollapp </li> <li>set minimum packet timeout (i.e. 1ms) so that the packet is not relayed before it is picked by a relayer  </li><li> sender should get funds back after grace period. </li> <li> no packet commitment left on the rollapp (i.e ack recieved). can be queries using the cli rollapp-evm q ibc channel packet-commitments transfer <channel-id></li> <li> demand order is created with correct ibc denom and fee </li> <li>demand order can get fulfilled </li> <li>upon timeout the funds should go to the fulfiller </li> </ul>| | [TestIBCTransferTimeout_EVM](../tests/ibc_timeout_test.go#25) [TestIBCTransferTimeout_Wasm](../tests/ibc_timeout_test.go#256) |
| 5  | Rollapp token ibc-transfer timeout | Same as the case above | âœ… | <ul><li> send rollapp IBC denom from dymension to rollapp </li> <li> Same as the case above </li></ul> | | [TestIBCTransferTimeout_EVM](../tests/ibc_timeout_test.go#25) [TestIBCTransferTimeout_Wasm](../tests/ibc_timeout_test.go#256) |
| 6  | 3rd party token Demand order is created upon timeout and fulfilled | Same as the case above | âœ… | <ul><li> send 3rd party IBC denom from dymension to rollapp </li> <li> the amount returned should be smaller by a 0.15% fee </li> <li> market maker is able to fulfill it  </li> <li> no packet commitment left on the rollapp (i.e ack recieved). can be queries using the cli rollapp-evm q ibc channel packet-commitments transfer <channel-id> </li> <li> upon timeout the funds should go to the fulfiller </li> </ul>| âœ… | [TestEIBCTimeoutAndFulFillDymToRollapp](../tests/eibc_timeout_test.go#L266)  |
| 7  | Demand order is created upon AckError for dym | <ul><li> IBC which exists on the evm-rollapp but doesnâ€™t have erc20 </li> <li> At least 2 rollapps running, Rollapp A and B. Rollapp B is at finalized height < Rollapp A finalized height. Rollapp B has a channel-id different from the hub-channel-id. </li> </ul> | âœ… | <ul><li> send the DYM token from hub to rollapp </li> <li> fulfiller the order with the IBC denom </li> <li> ack error returned from the rollapp </li> <li> eibc ack error demand order is created with correct denom and correct data </li> <li> eibc managed to get fulfilled </li> <li>upon ack error the funds should go to the fulfiller </li> </ul> | âœ… | [TestEIBC_AckError_Dym_EVM](../tests/eibc_ack_error_test.go#L23) [TestEIBC_AckError_Dym_Wasm](../tests/eibc_ack_error_test.go#L1083) |
| 8  | Demand order is created upon AckError for 3rd party token |  Same as the case above | âœ… | <ul> <li> send the ibc token from hub to rollapp </li> <li> Same as the case above </li> </ul> | âœ… | [TestEIBC_AckError_3rd_Party_Token_EVM](../tests/eibc_ack_error_test.go#L716) [TestEIBC_AckError_3rd_Party_Token_Wasm](../tests/eibc_ack_error_test.go#L1771) |
| 9  | Demand order is created upon AckError for rollapp token |  Same as the case above | âœ… | <ul> <li> send the ibc token from hub to rollapp </li> <li> Same as the case above </li> </ul>  | âœ… | [TestEIBC_AckError_RA_Token_EVM](../tests/eibc_ack_error_test.go#L382) [TestEIBC_AckError_RA_Token_Wasm](../tests/eibc_ack_error_test.go#L1072) |
| 10 | eibc shouldnâ€™t work together with PFM | At least 2 rollapps running, Rollapp A and B. Rollapp B is at finalized height < Rollapp A finalized height. Rollapp B has a channel-id different from the hub-channel-id.| ðŸ›‘ <br> (missing)| Try to send RAX from rollapp to Dymension: <ul> <li> with both eibc and forward objects in memo. </li> <li> Forward object could specify an address </li></ul> The transfer should not be successful and RAX should be returned to rollappâ€™s wallet| ðŸ›‘ <br> (missing) | TO DO  |
| 11 | Demand order fulfillment | eIBC pending order on the hub | âœ… | <ul><li> fulfill the eIBC order  </li> <li> IBC Amount goes to the fulfiller upon finalization </li> <li> Amount - Fee goes to the user </li> </ul>| âœ… | [TestEIBCFulfillment_EVM](../tests/ibc_grace_period_test.go#28) [TestEIBCFulfillment_Wasm](../tests/eibc_fulfillment_test.go#322) |
| 12 | Demand order not fulfillment | eIBC pending order on the hub | âœ… | <ul><li> donâ€™t fulfill the eIBC demand order  </li> <li>  user gets the entire amount upon grace period  </li> </ul>|  âœ… | [TestEIBCNotFulfillment_EVM](../tests/eibc_not_fulfillment_test.go#L25) [TestEIBCNotFulfillment_Wasm](../tests/eibc_not_fulfillment_test.go#L285) |
| 13 | Demand order with fee > amount fails | send eIBC order (rollapp to hub) from CLI with fee > total amount (use memo)  | ðŸ›‘ <br> (missing) | should return ack error from the hub | ðŸ›‘ <br> (missing) | TO DO  |
| 14 | Demand order with invalid fee fails | send eIBC order (rollapp to hub) from CLI with invalid fee (i.e minus/letters etc)   | ðŸ›‘ <br> (missing) | should return ack error from the hub | ðŸ›‘ <br> (missing) | TO DO  |
| 15 | Send eIBC order (rollapp to hub) from CLI with invalid fee (i.e minus/letters etc)  | | | <ul>  <li> send IBC order from rollapp to hub without specifying eIBC memo  </li> <li> eibc order shouldnâ€™t be created </li> <li>upon finalization period amount should be transferred to original sender </li> </ul> | âœ… | [ibc_transfer_test](../tests/ibc_transfer_test.go) |
| 16 | Demand order for hub to rollapp transfer should be ignored and not created | | | <ul>  <li> send IBC order from hub to rollapp specifying eIBC memo  </li> <li> eibc order shouldnâ€™t be created </li> </ul> | âœ… | [TestEIBCFulfillment_ignore_hub_to_RA_EVM](../tests/eibc_fulfillment_test.go#L2532) [TestEIBCFulfillment_ignore_hub_to_RA_Wasm](../tests/eibc_fulfillment_test.go#L2784) |
| 17 | Demand order fulfillment from one rollapp, no fulfillment from other rollapp | <ul> <li> eIBC order pending on the hub coming from rollapp  </li> <li> eIBC order pending on the hub coming from rollapp 2 </li> </ul>| âœ… | <ul> <li> fulfill the order coming from rollapp 1 </li> <li> user gets amount minus fee for demand order coming from rollapp 1 </li> <li> market maker gets amount upon grace period of IBC packet coming from rollapp 1 </li> <li>user gets amount upon grace period of IBC packet coming from rollapp 2 </li> <li> no packet commitment left on the rollapp (i.e ack recieved). can be queries using the cli rollapp-evm q ibc channel packet-commitments transfer <channel-id></li> </ul> | âœ… | [TestEIBCFulfillOnOneRollApp_EVM](../tests/eibc_fulfillment_test.go#28) [TestEIBCFulfillOnOneRollApp_Wasm](../tests/eibc_fulfillment_test.go#397)  |
| 18 | Demand order fulfillment in 2 different rollapps |  Same as the case above | âœ… | <ul> <li> fulfill the order coming from rollapp 1 </li> <li> fulfill the order coming from rollapp 2 </li> <li>user gets amount minus fee for demand order coming from rollapp 1 </li> <li> market maker gets amount upon grace period of IBC packet coming from rollapp 1 </li>  <li>user gets amount minus fee for demand order coming from rollapp 2 </li> <li> market maker gets amount upon grace period of IBC packet coming from rollapp 2 </li> <li> no packet commitment left on the rollapp (i.e ack recieved). can be queries using the cli rollapp-evm q ibc channel packet-commitments transfer <channel-id></li> </ul> | âœ… | [TestEIBCFulfillment_two_rollapps](../tests/eibc_fulfillment_test.go#1365) |
